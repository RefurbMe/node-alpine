machine:
  services:
    - docker
  pre:
    - echo 'export IMAGE_NAME=refurbme/node-alpine:node-6' >> ~/.circlerc

dependencies:
  override:
    - docker build -t $IMAGE_NAME .

test:
  override:
    - docker run $IMAGE_NAME node -v
    - docker run $IMAGE_NAME npm -v
    - docker images | grep $IMAGE_NAME

deployment:
  hub:
    branch: node-6
    commands:
      - sudo pip install docker-scripts
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker-scripts squash $IMAGE_NAME
      - docker images | grep $IMAGE_NAME
      - docker push $IMAGE_NAME
